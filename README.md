## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:7890](http://localhost:7890) with your browser to see the result.

## Sanity

To connect to a Sanity project, you must be a member of the Sanity org.  When first starting a new project with this template, download the Sanity CLI and run `sanity login`.  Once logged in, run `sanity init` and follow the prompts.  Since this project uses an embedded Sanity studio, exit the prompts at the step that says: __"Project output path: "__ with either `option + C` (macOS) or `control + C` (windows) so as to not allow Sanity to create a standalone studio within your project.

Make sure to update the `projectId` everywhere in the codebase, including `.env.local`, `sanity.cli.ts`, and both configs in `sanity.config.ts` with the projectId you'd like to use from YOUR Sanity org.

## Husky and lint-staged

This project uses both husky and lint-staged, in conjunction with a robust eslint and prettier setup to maintain opinionated coding standards on _pre-commit_. So... when you commit to Github, the process runs, checks for linting errors and auto formats based on the prettier/eslint rules set in the repo.

\*\*If the process does not run for you when first cloning the repo, open the `.husky/pre-commit` file and save it. I'm not sure why you need to do this but seems to be the only way to get it to work upon cloning.

If this doesn't work, you may need to run `bunx husky init`, after which you'll need to update your `.husky/pre-commit` file with the following contents:
```
#!/usr/bin/env sh
bun lint-staged
```

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

This Project is setup to auto deploy on merge to `main` branch and generate a preview link (as a github comment) using `vercel-actions` in separate Github actions.

## For Github actions to work properly:

### Be sure to update environment variables in your Vercel project:

- __NEXT_PUBLIC_SANITY_API_VERSION__ *the current date of setting up your project*
- __NEXT_PUBLIC_SANITY_DATASET__ *set in the Sanity dashboard, usually something like "development".  In vercel, set 2 of the same name, one for production, and one for pre-production environments*
- __NEXT_PUBLIC_SANITY_PROJECT_ID__ *Found at the top of the Sanity dashboard inside your project*
- __SANITY_API_DEPLOY_TOKEN__  *set in the Sanity dashboard, under "API -> Tokens"*
- __NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME__ *found in the top-left of the Cloudinary dashboard after logging in*
- __DATABASE_URL__ *You can find your Neon database connection string by clicking the Connect button on your Neon Project Dashboard to open the Connect to your database modal.*

### Be sure to set secrets in your Github repo (settings -> Secrets and Variables -> Actions):

**All Of the above set in Vercel, as well as:**

- VERCEL_TOKEN _created in vercel account settings -> Tokens_
- GITHUB_TOKEN _this is autogenerated by Github_
- ORG_ID _Vercel: if in a team, this is the Team_ID_
- PROJECT_ID _vercel project id, found in settings of the project (not the Sanity project token)_

**Sanity Typegen commands**

- `bunx sanity schema extract --enforce-required-fields --workspace [workspace]` _(either `development` or `production` for our setup).  This creates a `schema.json` file at the root of the project._
- `bunx sanity@latest typegen generate` _this is the command that creates the `sanity.types.ts` file containing types for all your Sanity Studio schema types_

## Testing

_For components that rely on environment variables, like the `CloudinaryImg` component, we need to create a `.env.test` file to place these variables in.  It's in `.gitignore` so will not show up when cloning the repo._

We're using Bun's test runner with matchers and types for React Testing Library (RTL) extended from `@testing-library/jest-dom/matchers` and specifically the `.toHaveNoViolations()` assertion from `jest-axe`.  Bun's test runner isn't built out completely yet so we have to add a cleanup function for `afterEach` test runs to our test preload array in `bunfig.toml`. This can be found in `testing-library.ts`.

RTL and happy-dom doesn't allow for testing with tailwind's media query classes _Like `sm:hidden`_, but we can test for conditional classes _Like `isOpen ? 'hidden' : 'flex'`_.  We'll eventually want to add `Cypress` or `Playwright` if we want to test Tailwind's media queries and implement E2E testing.
